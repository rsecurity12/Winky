<!DOCTYPE html>
<html>

<head>
    <title>Add a danger place</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/423e533185.js" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/423e533185.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="../../css/style.css">
    <link rel="stylesheet" type="text/css" href="../../css/styleProfile.css">
    <link rel="stylesheet" type="text/css" href="../../css/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@v0.74.0/dist/L.Control.Locate.min.css" />
    <script>
        function locatePage(location) {
            window.location = location + ".html";
        }
    </script>
</head>

<body>
    <div class="container1">       
        <div class="menushape1"></div>
        <div class="menushape2"></div>
        <ul class="menubar">
            <li><i class="fa fa-arrow-left" id="arrowBack" aria-hidden="true" onclick="locatePage('user_map')"></i></li>
            <li>
                <div class="welcomeMessage">
                    <h1>Add a danger place</h1>
                </div>
            </li>
            <li>
                <img id="logoNotfication" src="../../images/FullLogo.png" alt="Winky Logo">
            </li>
        </ul>
    </div>
    <div class="container">
        <div class="app">
            <form action="#">
                <!-- titel en beschrijving -->
                <div class="form-group" id="labelDescription">
                    <label for="title">Title:</label>
                    <input type="text" class="form-control" id="title" placeholder="Enter title" name="name">
                </div>
                <div class="form-group" id="labelDescription">
                    <label for="description">Description:</label>
                    <input type="textarea" class="form-control" id="description" placeholder="Enter description" name="description">
                </div>

                <!-- positie divs -->
                <div class="form-group" id="positionState" required> <label for="description">Choose your position: </label> <br>
                    <input type="radio" id="localPosition" name="mapState" onclick="my_function(localPosition)" required>
                    <label for="localPosition">Current location</label>
                    <input type="radio" id="mapChoice" name="mapState" onclick="my_function(mapChoice)" checked required>
                    <label for="mapChoice">Map, click a place on the map.</label>
                </div>
                <!-- Dangerous state divs -->
                <div class="form-group" id="radioButtons" required> <label for="description">How dangerous is this problem?: </label><br>
                    <input type="radio" id="red" name="notificationState" value="red" required>
                    <label for="red" style="color:red;">Very dangerous</label>
                    <input type="radio" id="orange" name="notificationState" value="orange" required>
                    <label for="orange" style="color:orange;">Dangerous</label>
                    <input type="radio" id="green" name="notificationState" value="green" required>
                    <label for="green" style="color:green;">Annoying</label>
                </div>
            </form>
            <button type="button" class="btn_normal" id="addNotBtn" style="display: none;" onclick="save_notification(Lat, Long)">Save notification</button>
            <div id="my_div">
                <div id="map">
                </div>
            </div>
        </div>
    </div>
</body>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="../../js/notificationManager.js"></script>
<script src="../../js/regionManager.js"></script>
<script src="../../js/connection.js"></script>
<script>
    //Gekozen latitude en logitude voor de notificatie
    var Lat = "";
    var Long = "";

    //Latitude en Longitude via current locatie
    var curLat = "";
    var curLong = "";

    var loadMap = function(id) {
        var popup = L.popup();
        var map = L.map(id, {
            minZoom: 4,
            maxZoom: 18
        });
        var tile_url = 'https://{s}.tile.osm.org/{z}/{x}/{y}.png';
        var layer = L.tileLayer(tile_url, {
            attribution: 'OSM'
        });

        map.addLayer(layer);
        map.locate({
                setView: true,
                watch: true
            })
            .on('locationfound', function(e) {
                curLat = e.latitude
                curLong = e.longitude

            })
            .on('locationerror', function(e) {
                console.log(e);
                alert("Location access denied.");
            })
            .on('click', function(e) {
                Lat = e.latlng.lat;
                Long = e.latlng.lng;
                popup
                    .setLatLng(e.latlng)
                    .setContent("You clicked the map at " + e.latlng.toString())
                    .openOn(map);
                showButton();

            });
    };
    loadMap('map');

    function my_function(elm) {
        if (elm == document.getElementById('localPosition')) {
            document.getElementById('my_div').style.display = "none";
            Lat = curLat;
            Long = curLong;
            showButton();

        } else if (elm == document.getElementById('mapChoice')) {
            document.getElementById('my_div').style.display = "block";
        }
    }
    function showButton(){
        document.getElementById('addNotBtn').style.display = "block";
    }
</script>

</html>